# 第一部分 基本介绍

## 第一章 Python基础

### 1. Python如何运行

> 当python运行脚本时，在代码运行开始处理之前，Python还会执行一些步骤。**确切地说，第一步时编译成所谓的“字节码”，之后将其转发到所谓的“虚拟机”中。**同时，Python是不需要预编译的，它的预编译等是与脚本的运行同步进行的，这使得用户能够动态修改代码（即通过eval与exec，因为python是逐句编译的）。

#### 1.1 编译

字节码时一种低级的、与平台无关的表现形式。Python会将源代码逐句翻译为字节码以提高运行速度，相比于源代码，字节码的运行速度要快很多。

在Python这一过程是完全封装的，*如果Python进程拥有写入权限（如果没有，将会生成在内存中），那么它将把程序的字节码保存为一个以 `.pyc` 为扩展名的文件（即翻译过的源代码）*，在python3中，为了避免过多文件在同一文件夹下，生成的字节码文件会统一放在同一目录下的 `.pycache` 文件夹下。 同时，Python会检查源文件与字节码文件的最后修改时间戳（包括版本号的改变）以确认是否需要再次进行编译过程，若无修改直接读取对应的pyc文件，否则重写字节码文件。

最后，字节码只针对那些被导入的文件生成，而不

是顶层的执行脚本，这是对导入的一种优化。

#### 1.2 PVM（解释器）

一旦程序被编译成字节码，之后的字节码发送到通常被称为**Python虚拟机**(Python Virtual Machine)的程序上来执行。

实际上，虚拟机不是一个独立的程序，不需要安装，它依附于Python系统之上。本质上，PVM就是迭代运行字节码指令的一个大循环，一个接一个地完成操作。



### 2. Python的各种实现

> Python实际上是一门语言规范，只是定义了Python这门语言应该具备哪些语言要素，应当能完成什么样的任务。这种语言规范可以用不同的方式实现，可以用C实现，也可以用C++、Java、C#、JavaScript，甚至使用Python自己实现。

#### CPython（标准Python）

> **CPython是标准Python，是最初的、标准的python实现方式，这就是从官网获取以及绝大多数Linux系统内置的Python。**CPython由C编写，将Python源码编译成CPython字节码，由虚拟机解释执行。没有用到JIT等技术，垃圾回收方面采用的是引用计数。

*所以当有人问道Python是解释执行还是编译执行，可以这样回答：Python（CPython）将Python源码编译成CPython字节码，再由虚拟机解释执行这些字节码。*

#### Jython

> Jython(最初被称为JPython)在JVM上实现的Python，由Java编写。Jython将Python源码编译成JVM字节码，由JVM执行对应的字节码。因此能很好的与JVM集成，比如利用JVM的垃圾回收和JIT，直接导入并调用JVM上其他语言编写的库和函数。

#### IronPython

> IronPython与Jython类似，所不同的是IronPython在CLR上实现了Python，即面向windows的**.NET**平台，由C#编写。与Jython相同，可以利用.NET框架的JIT、垃圾回收等功能，能导入并调用.NET上其他语言编写的库和函数。IronPython默认使用Unicode字符串。

#### PyPy

> **PyPy系统是CPython的另一种标准实现，它更注重性能。**它提供了一个带有即时编译器(just-in-time, JIT) 的Python快速实现，能够在安全环境下运行不信任代码的“沙箱”模型的工具。JIT在编译过程中直接将文件编译为二进制而非字节码，从而大幅度提升运行速度，**它的运行速度比CPython3快十倍甚至几十倍，在某些情况下甚至能超过C**，同时，它还对内存管理进行了优化。
>
> 想对于CPython，PyPy的性能提升非常明显，但却不能很好地支持第三方模块。更多详情关注 [官网](https://www.pypy.org/) 。



### 3. 执行优化工具

> PVM解释器可以有多种系统选择用于执行，最基本的Cython外，其他系统都尝试于优化基本执行模块。

#### Cython

> Cython系统是一种混合语言（Python与C），它为Python代码配备了调用C函数以及使用变量、参数和类属性的C类型声明的能力。Cython代码可以编译成使用Python/C API的C代码，随后可以再完整编译。

#### Shed Skin

> Shed Skin 是一个新兴的系统，它采用了一种不同的Python程序执行方式，尝试将Python代码翻译成C++代码，然后再使用机器中的C++编译器将得到的C++代码编译为机器代码，通过这种方式，它以一种平台无关的方式来运行Python代码。

#### Psyco

> Psyco是原先的即时编辑器，它并不是Python的另一种实现方式，而是一个可以让程序运行得更快的扩展字节码执行模板组件。今天，它已经是一个过时的项目，跟不上Python的演化并且不再被积极维护，然而它的思想被PyPy所继承。
>
> Psyco是一个对PVM的增强工具，这个工具在程序运行时手机并使用类型信息，可以将部分程序的字节码转换成底层的真正的二进制机器代码，从而实现更快的执行速度。在开发过程中，Psyco无须修改代码或者独立的编译步骤即可完成这一转换。



### 4. Unix风格

> 如果在Linux等Unix系统上使用Python，可以将Python代码编程为可执行程序，就像使用Shell语言编写的csh或ksh程序一样。这样的脚本往往被称为**可执行脚本**，简而言之，UNIX风格的可执行脚本只是包括了Python语句的一般文本文件，但是有两个特殊属性：

+ **它们的第一行是特定的。**	脚本的第一行往往是以字符 `#!` 开始，其后紧跟Python解释器路径。
+ **它们往往都有可执行权限。**	脚本文件通过告诉操作系统它们可以作为顶层文件执行，而拥有可执行权限。

因此，对于单独的（即不被调用的）UNIX风格的脚本，其命名可以不带有扩展名（这种系统下的python文件第一行具有特殊意义）。

```python
#!/usr/bin/env python
```



### 5. IDE

关于IDE与IDLE就不再介绍。

> 在IDLE中，使用 <Alt-P> 回滚历史命令，使用 <Alt-N>向前寻找命令，也可以将光标放在目标命令上，然后点击并按下 <Enter> 在输入提示下插入文本已重新运行命令。



